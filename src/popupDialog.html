<!DOCTYPE html>
<html>
<head>
  <title>Team Member Randomizer</title>
  <script src="../node_modules/vss-web-extension-sdk/lib/VSS.SDK.min.js"></script>
  <style>
    .bold {
      font-weight: bold;
    }

    .completed {
      text-decoration: line-through;
      color: #999;
    }

    #message {
      margin: 10px;
    }

    #canvas {
      display: none;
    }
  </style>
</head>
<body style="background-color:inherit">
  <canvas id="canvas"></canvas>
  <p id="message"></p>
  <table id="team"></table>
  <script type="text/javascript">
    "use strict";

    const team = document.getElementById("team");
    const canvas = document.getElementById("canvas");
    const message = document.getElementById("message");

    VSS.init({ explicitNotifyLoaded: true, usePlatformScripts: true });

    VSS.require(["VSS/Service", "TFS/Core/RestClient"], (VSS_Service, TFS_RestClient) => {
      const _client = VSS_Service.getCollectionClient(TFS_RestClient.CoreHttpClient4_1);
      
      const webContext = VSS.getWebContext();
      
      const projectId = webContext.project.id;
      const teamId = webContext.team.id;

      let counter = 0;

      _client.getTeamMembersWithExtendedProperties(projectId, teamId, 100, 0).then((members) => {
        const createRowForTeamMember = (member) => {
          const row = document.createElement("tr");
          row.id = `member-${member.identity.id}`;

          const id = document.createElement("td");
          const photo = document.createElement("td");
          const name = document.createElement("td");

          id.innerText = ++counter;
          photo.innerHTML = "<img src='" + member.identity.imageUrl + "' />";
          name.innerHTML = "<span>" + member.identity.displayName + "</span>";

          row.appendChild(id);
          row.appendChild(photo);
          row.appendChild(name);

          return row;
        }
      });

      VSS.notifyLoadSucceeded();
    });
  </script>
</body>
</html>
